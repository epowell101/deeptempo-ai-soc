{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://deeptempo.ai/schemas/finding.schema.json",
  "title": "DeepTempo Finding",
  "description": "A security finding from DeepTempo LogLM with embedding and MITRE ATT&CK predictions",
  "type": "object",
  "required": ["finding_id", "embedding", "mitre_predictions", "anomaly_score", "timestamp", "data_source"],
  "properties": {
    "finding_id": {
      "type": "string",
      "description": "Unique identifier for the finding",
      "pattern": "^f-[0-9]{8}-[a-f0-9]{8}$",
      "examples": ["f-20240115-a1b2c3d4"]
    },
    "embedding": {
      "type": "array",
      "description": "768-dimensional embedding vector from LogLM",
      "items": {
        "type": "number"
      },
      "minItems": 768,
      "maxItems": 768
    },
    "mitre_predictions": {
      "type": "object",
      "description": "Map of MITRE ATT&CK technique IDs to confidence scores",
      "additionalProperties": {
        "type": "number",
        "minimum": 0,
        "maximum": 1
      },
      "examples": [{"T1071.001": 0.85, "T1048.003": 0.72}]
    },
    "anomaly_score": {
      "type": "number",
      "description": "Overall anomaly score from LogLM (0-1)",
      "minimum": 0,
      "maximum": 1
    },
    "entity_context": {
      "type": "object",
      "description": "Contextual information about involved entities",
      "properties": {
        "src_ip": {
          "type": "string",
          "format": "ipv4",
          "description": "Source IP address"
        },
        "dst_ip": {
          "type": "string",
          "format": "ipv4",
          "description": "Destination IP address"
        },
        "src_port": {
          "type": "integer",
          "minimum": 0,
          "maximum": 65535,
          "description": "Source port"
        },
        "dst_port": {
          "type": "integer",
          "minimum": 0,
          "maximum": 65535,
          "description": "Destination port"
        },
        "hostname": {
          "type": "string",
          "description": "Hostname of the source system"
        },
        "user": {
          "type": "string",
          "description": "Username associated with the activity"
        },
        "app": {
          "type": "string",
          "description": "Application name"
        },
        "protocol": {
          "type": "string",
          "description": "Network protocol"
        },
        "query_name": {
          "type": "string",
          "description": "DNS query name (for DNS findings)"
        },
        "query_type": {
          "type": "string",
          "description": "DNS query type (for DNS findings)"
        },
        "method": {
          "type": "string",
          "description": "HTTP method (for WAF findings)"
        },
        "uri": {
          "type": "string",
          "description": "Request URI (for WAF findings)"
        },
        "status_code": {
          "type": "integer",
          "description": "HTTP status code (for WAF findings)"
        },
        "user_agent": {
          "type": "string",
          "description": "User agent string (for WAF findings)"
        }
      }
    },
    "evidence_links": {
      "type": "array",
      "description": "Pointers to raw log evidence",
      "items": {
        "type": "object",
        "required": ["type", "ref"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["flow", "dns", "waf"],
            "description": "Evidence type"
          },
          "ref": {
            "type": "string",
            "description": "Reference path to the evidence file"
          },
          "lines": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "minItems": 2,
            "maxItems": 2,
            "description": "Start and end line numbers"
          },
          "hash": {
            "type": "string",
            "description": "Optional hash for integrity verification"
          }
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the finding"
    },
    "data_source": {
      "type": "string",
      "enum": ["flow", "dns", "waf"],
      "description": "Source data type"
    },
    "cluster_id": {
      "type": ["string", "null"],
      "description": "Optional cluster assignment",
      "pattern": "^c-[a-z]+-[0-9]{3}$"
    },
    "severity": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Severity level"
    },
    "status": {
      "type": "string",
      "enum": ["new", "investigating", "resolved", "false_positive"],
      "description": "Finding status"
    }
  }
}
